// TODO move code from .h